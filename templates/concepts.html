{% extends "base.html" %}
{% block title %}Spanish Vibes Â· Concepts{% endblock %}
{% block content %}
<div class="flex flex-col gap-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-black text-slate-50">Concept Curriculum</h2>
      <p class="text-sm text-slate-400 mt-1">{{ mastered_count }}/{{ total_concepts }} concepts mastered</p>
    </div>
    <div class="flex gap-2">
      <a href="/flow/stats" class="rounded-full bg-violet-500/15 px-4 py-2 text-sm font-bold text-violet-300 transition hover:bg-violet-500/25">Stats</a>
      <a href="/flow" class="rounded-full bg-amber-500/15 px-4 py-2 text-sm font-bold text-amber-300 transition hover:bg-amber-500/25">Start Flow</a>
    </div>
  </div>

  <!-- Overall progress bar -->
  <div class="relative h-4 w-full overflow-hidden rounded-full bg-[#0f1a1f]">
    <div class="h-full rounded-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500"
         style="width: {{ (mastered_count / total_concepts * 100) | int if total_concepts > 0 else 0 }}%"></div>
    <span class="absolute inset-0 flex items-center justify-center text-[11px] font-bold text-white drop-shadow">
      {{ mastered_count }}/{{ total_concepts }} mastered
    </span>
  </div>

  <!-- Tiers -->
  {% for tier_num, concepts in tiers.items() %}
  <div class="rounded-2xl bg-[#1a2d35] p-5 shadow-lg shadow-black/20">
    <h3 class="text-lg font-black text-slate-50 mb-4 flex items-center gap-2">
      <span class="inline-flex h-7 w-7 items-center justify-center rounded-lg bg-sky-500/20 text-sm font-black text-sky-300">{{ tier_num }}</span>
      Tier {{ tier_num }}
      <span class="text-xs text-slate-500 font-bold ml-auto">
        {{ concepts | selectattr("status", "equalto", "mastered") | list | length }}/{{ concepts | length }}
      </span>
    </h3>
    <div class="grid gap-3 sm:grid-cols-2">
      {% for concept in concepts %}
      <div class="rounded-xl p-4 transition
        {% if concept.status == 'mastered' %}bg-emerald-500/10 border border-emerald-500/20
        {% elif concept.status == 'learning' %}bg-amber-500/10 border border-amber-500/20
        {% elif concept.status == 'locked' %}bg-slate-800/50 border border-slate-700/30 opacity-50
        {% else %}bg-[#0f1a1f] border border-[#2a3f4a]{% endif %}">

        <div class="flex items-center justify-between mb-2">
          <h4 class="font-bold text-sm
            {% if concept.status == 'mastered' %}text-emerald-300
            {% elif concept.status == 'learning' %}text-amber-300
            {% elif concept.status == 'locked' %}text-slate-500
            {% else %}text-slate-200{% endif %}">
            {% if concept.status == 'locked' %}&#x1f512; {% endif %}
            {{ concept.name }}
          </h4>
          <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full
            {% if concept.status == 'mastered' %}bg-emerald-500/20 text-emerald-400
            {% elif concept.status == 'learning' %}bg-amber-500/20 text-amber-400
            {% elif concept.status == 'locked' %}bg-slate-700/40 text-slate-500
            {% else %}bg-sky-500/20 text-sky-400{% endif %}">
            {{ concept.status }}
          </span>
        </div>

        {% if concept.status != 'locked' %}
        <!-- Mastery bar -->
        <div class="relative h-2 w-full overflow-hidden rounded-full bg-[#0f1a1f] mb-2">
          <div class="h-full rounded-full transition-all duration-500
            {% if concept.status == 'mastered' %}bg-emerald-500{% else %}bg-amber-500{% endif %}"
            style="width: {{ concept.mastery_pct }}%"></div>
        </div>
        <div class="flex items-center justify-between text-[11px] text-slate-500">
          <span>{{ concept.mastery_pct }}% mastery</span>
          {% if concept.n_attempts > 0 %}
          <span>{{ concept.n_attempts }} attempts &middot; {{ concept.accuracy }}% acc</span>
          {% endif %}
        </div>
        {% else %}
        <p class="text-[11px] text-slate-600 mt-1">Complete prerequisites to unlock</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
