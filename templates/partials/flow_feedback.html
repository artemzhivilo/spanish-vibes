{% if is_correct %}
<div class="correct-flash rounded-2xl bg-emerald-500/10 p-6 shadow-lg shadow-emerald-500/10 ring-1 ring-emerald-500/30">
  <div class="flex items-center gap-3">
    <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-emerald-500 text-lg font-black text-emerald-950">âœ“</span>
    <div class="flex-1">
      <p class="text-lg font-black text-emerald-300">Correct!</p>
      <p class="text-sm text-emerald-200/70">
        {{ correct_answer }}
        <button type="button"
          onclick="this.classList.add('speak-active'); speakSpanish({{ correct_answer | tojson }})"
          class="inline ml-1 text-slate-400 hover:text-emerald-300"
          title="Listen">ðŸ”Š</button>
      </p>
    </div>
  </div>

  <div class="mt-3 flex items-center gap-2">
    {% if xp_earned %}
      <span class="xp-badge rounded-full bg-amber-500/20 px-3 py-1 text-sm font-black text-amber-400">+{{ xp_earned }} XP</span>
    {% endif %}
    {% if streak > 0 %}
      <span class="xp-badge rounded-full bg-amber-500/15 px-3 py-1 text-sm font-bold text-amber-400">ðŸ”¥ {{ streak }}</span>
    {% endif %}
  </div>

  <!-- Auto-advance after 1.2s -->
  <div hx-get="/flow/card?session_id={{ session_id }}"
       hx-target="#flow-card-slot"
       hx-swap="innerHTML"
       hx-trigger="load delay:1200ms">
    <div class="mt-4 h-1 rounded-full bg-[#0f1a1f] overflow-hidden">
      <div class="h-full bg-emerald-500/50 rounded-full" style="animation: fillBar 1.2s linear forwards"></div>
    </div>
  </div>
</div>

<style>
  @keyframes fillBar { from { width: 0%; } to { width: 100%; } }
</style>

<script>
  (function() {
    var streakEl = document.getElementById('streak-count');
    if (streakEl) {
      streakEl.textContent = '{{ streak }}';
      streakEl.classList.add('streak-pop');
      setTimeout(function() { streakEl.classList.remove('streak-pop'); }, 400);
    }
    var fireEl = document.getElementById('streak-fire');
    if (fireEl) fireEl.classList.remove('opacity-30');
    var cardsEl = document.getElementById('cards-count');
    if (cardsEl) cardsEl.textContent = '{{ cards_answered }} cards';
    var progressEl = document.getElementById('concepts-progress');
    if (progressEl) progressEl.textContent = '{{ concepts_mastered }}/{{ total_concepts }}';
    if (typeof showCelebration === 'function') showCelebration({{ streak }});
  })();
</script>

{% else %}

<div class="wrong-flash rounded-2xl bg-[#1a2d35] p-6 shadow-lg shadow-black/20 ring-1 ring-red-500/25">
  <div class="flex items-center gap-3">
    <span class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-red-500/20 text-lg font-bold text-red-400">âœ—</span>
    <div class="flex-1">
      <p class="text-lg font-bold text-red-300">Not quite</p>
      <p class="mt-1 text-sm text-slate-300">
        <span class="text-emerald-300 font-bold">{{ correct_answer }}</span>
        <button type="button"
          onclick="this.classList.add('speak-active'); speakSpanish({{ correct_answer | tojson }})"
          class="inline ml-1 text-slate-400 hover:text-emerald-300"
          title="Listen">ðŸ”Š</button>
      </p>
      {% if chosen_option %}
      <p class="mt-0.5 text-xs text-slate-500">
        You chose: <span class="line-through">{{ chosen_option }}</span>
      </p>
      {% endif %}
    </div>
  </div>

  {% if misconception_hint %}
    <div class="mt-3 rounded-xl bg-sky-500/10 ring-1 ring-sky-500/25 px-4 py-3">
      <p class="text-sm text-sky-300">ðŸ’¡ {{ misconception_hint }}</p>
    </div>
  {% endif %}
  {% if wrong_explanation %}
    <div class="mt-3 rounded-xl bg-slate-900/50 ring-1 ring-slate-700 px-4 py-3">
      <p class="text-sm text-slate-200">Why this was wrong: {{ wrong_explanation }}</p>
    </div>
  {% endif %}

  <button
    hx-get="/flow/card?session_id={{ session_id }}"
    hx-target="#flow-card-slot"
    hx-swap="innerHTML"
    class="mt-4 w-full rounded-xl bg-slate-700 px-6 py-3 text-base font-bold text-slate-200 transition hover:bg-slate-600 active:scale-[0.98]">
    Continue
  </button>
</div>

<script>
  (function() {
    var streakEl = document.getElementById('streak-count');
    if (streakEl) streakEl.textContent = '0';
    var fireEl = document.getElementById('streak-fire');
    if (fireEl) fireEl.classList.add('opacity-30');
    var cardsEl = document.getElementById('cards-count');
    if (cardsEl) cardsEl.textContent = '{{ cards_answered }} cards';
    var progressEl = document.getElementById('concepts-progress');
    if (progressEl) progressEl.textContent = '{{ concepts_mastered }}/{{ total_concepts }}';
  })();
</script>

{% endif %}
