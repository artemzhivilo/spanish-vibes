{% if is_correct %}
<div class="correct-flash rounded-2xl bg-[#1a2d35] p-6 shadow-lg shadow-black/20 ring-1 ring-emerald-500/30">
  <div class="flex items-center gap-3">
    <span class="text-3xl">âœ“</span>
    <div>
      <p class="text-lg font-bold text-emerald-300">Correct!</p>
      <p class="text-sm text-emerald-200/80">
        {{ correct_answer }}
        <button type="button"
          onclick="this.classList.add('speak-active'); speakSpanish({{ correct_answer | tojson }})"
          class="inline ml-1 text-slate-400 hover:text-emerald-300"
          title="Listen">ðŸ”Š</button>
      </p>
    </div>
  </div>

  <div class="mt-3 flex items-center gap-3">
    {% if xp_earned %}
      <span class="rounded-full bg-amber-500/20 px-3 py-1 text-sm font-black text-amber-400">+{{ xp_earned }} XP</span>
    {% endif %}
    {% if streak > 0 %}
      <span class="rounded-full bg-amber-500/15 px-3 py-1 text-sm font-bold text-amber-400">ðŸ”¥ {{ streak }}</span>
    {% endif %}
  </div>

  <!-- Auto-advance after 1.0s -->
  <div hx-get="/flow/card?session_id={{ session_id }}"
       hx-target="#flow-card-slot"
       hx-swap="innerHTML"
       hx-trigger="load delay:1000ms">
    <div class="mt-4 flex items-center justify-center gap-2 text-sm text-slate-500">
      <div class="h-4 w-4 animate-spin rounded-full border-2 border-emerald-500 border-t-transparent"></div>
      <span>Next card...</span>
    </div>
  </div>
</div>

<script>
  (function() {
    var streakEl = document.getElementById('streak-count');
    if (streakEl) streakEl.textContent = '{{ streak }}';
    var fireEl = document.getElementById('streak-fire');
    if (fireEl) fireEl.classList.remove('opacity-30');
    var cardsEl = document.getElementById('cards-count');
    if (cardsEl) cardsEl.textContent = '{{ cards_answered }} cards';
    var progressEl = document.getElementById('concepts-progress');
    if (progressEl) progressEl.textContent = '{{ concepts_mastered }}/{{ total_concepts }}';
    if (typeof showCelebration === 'function') showCelebration({{ streak }});
  })();
</script>

{% else %}

<div class="wrong-flash rounded-2xl bg-[#1a2d35] p-6 shadow-lg shadow-black/20 ring-1 ring-red-500/25">
  <div class="flex items-center gap-3">
    <span class="text-3xl">âœ—</span>
    <div>
      <p class="text-lg font-bold text-red-300">Not quite</p>
      <p class="mt-1 text-sm text-red-200/80">
        Correct answer: <span class="font-bold text-red-200">{{ correct_answer }}</span>
        <button type="button"
          onclick="this.classList.add('speak-active'); speakSpanish({{ correct_answer | tojson }})"
          class="inline ml-1 text-slate-400 hover:text-emerald-300"
          title="Listen">ðŸ”Š</button>
      </p>
      <p class="mt-1 text-sm text-red-200/60">
        You chose: <span class="font-semibold">{{ chosen_option or 'â€”' }}</span>
      </p>
    </div>
  </div>

  {% if misconception_hint %}
    <div class="mt-3 rounded-xl bg-sky-500/10 ring-1 ring-sky-500/25 px-4 py-3">
      <p class="text-sm text-sky-300">{{ misconception_hint }}</p>
    </div>
  {% endif %}

  <!-- Tap to continue -->
  <button
    hx-get="/flow/card?session_id={{ session_id }}"
    hx-target="#flow-card-slot"
    hx-swap="innerHTML"
    class="mt-5 w-full rounded-xl bg-slate-700 px-6 py-3 text-base font-bold text-slate-200 transition hover:bg-slate-600 active:scale-[0.98]">
    Got it â€” Next Card
  </button>
</div>

<script>
  (function() {
    var streakEl = document.getElementById('streak-count');
    if (streakEl) streakEl.textContent = '0';
    var fireEl = document.getElementById('streak-fire');
    if (fireEl) fireEl.classList.add('opacity-30');
    var cardsEl = document.getElementById('cards-count');
    if (cardsEl) cardsEl.textContent = '{{ cards_answered }} cards';
    var progressEl = document.getElementById('concepts-progress');
    if (progressEl) progressEl.textContent = '{{ concepts_mastered }}/{{ total_concepts }}';
  })();
</script>

{% endif %}
